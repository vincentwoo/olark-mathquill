// Generated by CoffeeScript 1.6.2
(function() {
  var HTML, has_mathed, initialized, olark_math, olark_math_container;

  HTML = $.trim("<div id=\"olark_math_container\" class=\"hbl_pal_main_bg\"\n    style=\"display: none; position: fixed; width: 200px\">\n  <span id=\"olark_math_title\" style=\"position: absolute; top: -20px; font-size: 14px\">\n    Need to enter some math?\n  </span>\n  <span class=\"mathquill-editable\" style=\"display: block; padding: 5px\">\n    f(x) = x^2 + 3x + 2\n  </span>\n</div>");

  has_mathed = false;

  initialized = false;

  olark_math_container = null;

  olark_math = null;

  olark('api.box.onShow', function() {
    var olark_input;

    if (initialized) {
      return;
    }
    initialized = true;
    olark_math_container = $(HTML).appendTo('body');
    olark_math = olark_math_container.find('.mathquill-editable');
    olark_math.mathquill('editable');
    olark_input = $('#habla_wcsend_input');
    olark_input.on('focus', function() {
      var offs_bottom, offs_right, olark_window;

      olark_window = $('#habla_window_div');
      offs_right = $(window).width() - olark_input.offset().left + 10;
      offs_bottom = olark_input.offsetParent().outerHeight() - olark_input.position().top - olark_input.outerHeight();
      olark_math.css({
        borderColor: olark_input.css('borderColor'),
        color: olark_input.css('color'),
        fontSize: olark_input.css('fontSize'),
        height: olark_input.outerHeight() - 12
      });
      return olark_math_container.css({
        right: offs_right,
        bottom: offs_bottom,
        height: olark_input.outerHeight()
      }).show();
    });
    return olark_math.one('click', function() {
      has_mathed = true;
      return olark_math.mathquill('latex', '');
    });
  });

  olark('api.box.onHide', function() {
    if (olark_math_container) {
      return olark_math_container.hide();
    }
  });

  olark('api.box.onShrink', function() {
    if (olark_math_container) {
      return olark_math_container.hide();
    }
  });

  olark('api.chat.onMessageToOperator', function(event) {
    if (!(olark_math && has_mathed && olark_math.mathquill('latex') !== '')) {
      return;
    }
    olark('api.chat.sendNotificationToOperator', {
      body: "math: " + (olark_math.mathquill('latex'))
    });
    olark_math.mathquill('latex', '');
    return olark_math.removeClass('hasCursor');
  });

}).call(this);
